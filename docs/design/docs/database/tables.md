# `riff`

## `1.Tables`

### `1.1.Scheduled`

- `riff_schedule_app`
  - `id`
    - `app_id`
  - `app_code`
    - `${spring.application.name}`
  - `app_name`
    - `Nullable`
  - `security`
    - `access_key`
      - `app_id`
    - `access_secret`
      - `app_secret`
  - `--------------------------------`
  - `cluster`
    - `host`
      - `in k8s`
      - `Nullable`
  - `config_namespace`
    - `Nacos`
      - `...`
    - `public`
      - `Nullable`
  - `config_group`
    - `Nacos`
      - `...`
    - `DEFAULT_GROUP`
      - `Nullable`
  - `--------------------------------`
  - `tenant`
    - `tenant`
      - `saas`
    - `platform`
      - `saas`
    - `app`
      - `boss`
      - `...`
- `riff_schedule_client`
  - `id`
  - `app_id`
  - `job_id`
  - `client_status`
    - `online`
      - `1`
    - `unhealthy`
      - `healthcheck_failure_count >=1 && healthcheck_failure_count < 4`
      - `2`
    - `suspect`
      - `healthcheck_failure_count == 4`
      - `4`
    - `offline`
      - `healthcheck_failure_count == 5`
      - `8`
  - `${server.ip}`
  - `${server.port}`
  - `${server.protocol}`
    - `http`
    - `gRPC`
  - `healthcheck_success_count`
    - `Server`
  - `healthcheck_failure_count`
    - `Server`
      - `30s * 5`
        - `offline`
  - `received_heartbeats`
    - `Client`
  - `online_time`
    - `datetime`
  - `offline_time`
    - `datetime`
- `riff_schedule_job`
  - `id`
    - `job_id`
  - `--------------------------------`
  - `tenant`
    - `saas`
  - `platform`
    - `saas`
  - `app`
    - `boss`
  - `--------------------------------`
  - `app_id`
  - `job_code`
    - `@RiffJob(value="io.github.photowey.saas.order.delayed.close")`
  - `job_name`
    - `Nullable`
  - `job_type`
    - `handler_job`
      - `1`
    - `scritp_job`
      - `2`
    - `http_job`
      - `4`
  - `handler_name`
    - `${ioc_handler_bean_name}`
    - `hello_python`
    - `hello_shell`
    - `hello_groovy`
    - `...`
  - `declared_class`
    - `io.github.photowey.rifftest.hello.handler.HelloHandler`
    - `hello_python.py`
    - `hello_shell.sh`
    - `hello_groovy.groovy`
    - `...`
  - `method`
    - `handle - default`
  - `arguments`
    - `type`
      - `txt` - `plain text`
      - `json`
      - `yml`
      - `xml`
      - `toml`
      - `hcl`
      - `...`
- `riff_schedule_job_chain`
  - `id`
    - `chain_id`
  - `parent_id`
  - `children_id`
  - `condition`
    - `${xxxStatus} == 1`
    - `${xxxEnabled}`
  - `context`
    - `k1==v1`
    - `k2==v2`
    - `k3==${SpEL}`
- `riff_schedule_job_trigger_record`
  - `id`
  - `app_id`
  - `--------------------------------`
  - `job_id`
  - `job_code`	
  - `--------------------------------`
  - `client_id`
  - `client_address`
    - `client_ip`
    - `client_port`
  - `--------------------------------`
  - `sharding_context`
    - `Nullable`
  - `--------------------------------`
  - `trigger_time`
  - `finished_time`
  - `trigger_status`
  - `trigger_context`
  - `trigger_source`
    - `script`
    - `...`
  - `trigger_code`
  - `trigger_message`
  - `retry_count`
  - `--------------------------------`
  - `handle_time`
  - `handle_code`
  - `handle_message`
  - `handle_status`
  - `--------------------------------`
  - `alarm_type`
  - `alarm_status`
  - `alarrm_context`

- `riff_schedule_job_trigger_stat`
  - `id`
  - `app_id`
  - `job_id`
  - `trigger_year`
  - `trigger_month`
  - `trigger_day`
  - `trigger_time`
  - `trigger_count`
  - `success_count`
  - `failure_count`
  - `retry_count`
- `riff_schedule_lock`
  - `io.github.photowey.riff.distributed.schedule.job.lock`
    - `Fixed`

### `1.2.System`

- `riff_system_user`
  - `id`
    - `user_id`
  - `--------------------------------`
  - `tenant`
  - `platform`
  - `app`
  - `--------------------------------`
  - `username`
  - `password`
  - `email`
  - `mobile`
  - `avatar`
  - `twofa_enabled`
  - `twofa_secret`
  - `...`
- `riff_system_role`
  - `id`
    - `role_id`
  - `role_code`
  - `role_name`
- `riff_system_user_role_link`
  - `id`
  - `user_id`
  - `role_id`
- `riff_system_role_app_link`
  - `id`
  - `role_id`
  - `app_id`
    - `${riff_scheduled_app.id}`

### `1.3.Authentication`

- `riff_authentication_token`
  - `id`
    - `authentication`
  - `app_id`
    - `${riff_scheduled_app.id}`
  - `authentication_type`
    - `web|dashboard`
      - `username`
      - `password`
      - `1`
    - `app|thirdparty`
      - `access_key`
      - `access_secret`
      - `2`
  - `authentication_key`
    - `${riff_system_user.username}`
    - `${riff_scheduled_app.access_key}`
  - `token_type`
    - `bearer`
      - `web`
        - `dashboard`
    - `distributed`
      - `${riff_scheduled_app}`
  - `token`
  - `token_expire_in`
    - `3600 * 24`
    - `${long-time}`
      - `100 YEAR || 1970-01-01`
  - `token_expire_time`
    - `datetime`
    - `${now} + ${token_expire_in} * 1000`
    - `${long-time}`
      - `100 YEAR || 1970-01-01`
  - `refresh_token`
  - `refresh_token_expire_in`
    - `3600 * 24 * 7`
    - `${long-time}`
      - `100 YEAR || 1970-01-01`
  - `refresh_token_expire_time`
    - `${long-time}`
      - `100 YEAR || 1970-01-01`



## 2.`Indices`
